import{L as Z,u as D,l as u,A as o}from"./index-B34NEXyu.js";const _=Z("userStore",()=>{const t=D();async function v(){const e=window.location.href;try{await navigator.clipboard.writeText(e),t.pushMessage(!0,"已複製網址！")}catch(a){t.pushMessage(!1,"複製失敗："+a)}}const c=u([]);function n(){const e=localStorage.getItem("favorites");e&&(c.value=JSON.parse(e))}function $(e){c.value.includes(e)?(c.value=c.value.filter(a=>a!=e),t.pushMessage(!1,"已取消收藏")):(c.value.push(e),t.pushMessage(!0,"已加入收藏")),localStorage.setItem("favorites",JSON.stringify(c.value))}const h=u(!1);async function x(e,a){t.isFullLoading=!0,h.value=!0;let s="https://vue3-course-api.hexschool.io/api/flurrypop-api/cart";const r={data:{product_id:e,qty:a}};try{const l=await o.post(s,r);t.pushMessage(l.data.success,l.data.message)}catch(l){t.pushMessage(!1,l.message)}finally{t.isFullLoading=!1,h.value=!1}}const p=u([]),g=u({});async function I(){let e="https://vue3-course-api.hexschool.io/api/flurrypop-api/products/all";try{const a=await o.get(e);p.value=a.data.products,g.value=p.value.find(s=>s.title=="運費"),p.value=p.value.filter(s=>s.category!="internal")}catch(a){console.error(a)}finally{t.isInlineLoading=!1}}const w=u(1),y=u([]),f=u(0);async function S(){t.isInlineLoading=!0;let e="https://vue3-course-api.hexschool.io/api/flurrypop-api/cart";try{const a=await o.get(e);y.value=a.data.data.carts,f.value=a.data.data.total}catch(a){console.error(a)}finally{t.isInlineLoading=!1}}let A=/^(?!\s*$)[\u4e00-\u9fa5A-Za-z\s]+$/,L=/^09\d{8}$/,M=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,P=/^\d{16}$/,b=/^\d{4}$/,F=/^\d{3}$/;const d=u("");async function m(e){let a=[],s=[];if(e.name==""?a.push("姓名"):A.test(e.name)||s.push("姓名"),e.tel==""?a.push("手機號碼"):L.test(e.tel)||s.push("手機號碼"),e.email==""?a.push("Email"):M.test(e.email)||s.push("Email"),e.delivery==""&&a.push("寄送方式"),e.delivery=="宅配"&&(e.city==""||e.area==""||e.address=="")&&a.push("地址"),e.pay==""&&a.push("付款方式"),e.pay=="信用卡"&&(e.cardNumber==""?a.push("卡號"):P.test(e.cardNumber)||s.push("卡號"),e.validDate==""?a.push("卡片有效日期"):b.test(e.validDate)||s.push("卡片有效日期"),e.securityCode==""?a.push("安全碼"):F.test(e.securityCode)||s.push("安全碼")),a.length>0||s.length>0){Array.isArray(a)&&(a=a.join("、")),Array.isArray(s)&&(s=s.join("、"));let r=`${a==""?"":"請填寫"}${a}${a!=""&&s!=""?"，":""}${s}${s==""?"":"為錯誤格式"}`;t.pushMessage(!1,r)}else{t.isFullLoading=!0;let r="實體店取貨";e.delivery=="宅配"&&(await R(g.value.id,1),r=e.city+e.area+e.address);let l=!1;e.pay=="信用卡"&&(l=!0);let N="https://vue3-course-api.hexschool.io/api/flurrypop-api/order";const z={data:{user:{name:e.name,email:e.email,tel:e.tel,address:r},message:""}};try{const i=await o.post(N,z);if(i.data.success)return d.value=i.data.orderId,localStorage.getItem("orderId")&&localStorage.removeItem("orderId"),localStorage.setItem("orderId",d.value),l&&await C(d.value),!0;t.pushMessage(i.data.success,i.data.message)}catch(i){t.pushMessage(!1,i.message)}finally{t.isFullLoading=!1}}}async function R(e,a){let s="https://vue3-course-api.hexschool.io/api/flurrypop-api/cart";const r={data:{product_id:e,qty:a}};try{const l=await o.post(s,r)}catch(l){console.error(l)}}async function C(e){let a=`https://vue3-course-api.hexschool.io/api/flurrypop-api/pay/${e}`;try{const s=await o.post(a)}catch(s){console.error(s)}}return{share:v,favoriteId:c,addFavorite:$,getFavorite:n,addLoading:h,addCart:x,product:p,freight:g,getProduct:I,step:w,cart:y,total:f,orderId:d,getCheckProduct:S,checkOrder:m}});export{_ as u};
